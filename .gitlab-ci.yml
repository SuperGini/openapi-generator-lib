image: openjdk:21-slim-bookworm

stages:
  - build
  - publish

workflow:
  rules:
    # Allow manual pipeline runs via the GitLab UI.
    # This is where you provide your "keyboard input" via the form.
    - if: '$CI_PIPELINE_SOURCE == "web"'
      when: always

build-stage:
  stage: build
  variables:
    openApiFileName:
      value: "default-value"
  script:
    - chmod +x ./gradlew
    - ./gradlew openApiGenerate -PopenApiFileName="$openApiFileName"
  artifacts:
    paths:
      - /build/libs/*.jar
    expire_in: 2 days

publish-stage:
  stage: publish
  variables:
    ci_JOB_TOKEN_OPEN_API:
      value: default-value
  script:
    - chmod +x ./gradlew
    - ./gradlew publish -Pci_JOB_TOKEN_OPEN_API="$ci_JOB_TOKEN_OPEN_API"

